---
import { checkModernFormats, getAvifPath, getWebpPath, getOptimizedSrc } from '@/utils/imageHelpers';

interface Props {
  src: string;
  alt: string;
  subtitle?: string;
  backlink?: string;
  backlinkText?: string;
}

const { src, alt, subtitle, backlink, backlinkText } = Astro.props;

// Check if modern formats exist (only for local static images)
const { avifExists, webpExists } = checkModernFormats(src);
const shouldUsePicture = avifExists && webpExists && (src.startsWith('/static/images/') || src.startsWith('static/images/'));
// Get optimized src for the img tag (prioritizes webp, falls back to original)
const optimizedSrc = getOptimizedSrc(src);
---

<div id="hero" class="not-prose w-full flex flex-col gap-2 justify-center items-start my-4 h-auto">
  {shouldUsePicture ? (
    <picture>
      <source type="image/avif" srcset={getAvifPath(src)} />
      <source type="image/webp" srcset={getWebpPath(src)} />
      <img
        src={optimizedSrc}
        alt={alt}
        loading="eager"
        class="w-full rounded-md block"
      />
    </picture>
  ) : (
    <img
      src={optimizedSrc}
      alt={alt}
      loading="eager"
      class="w-full rounded-md block"
    />
  )}
  {subtitle && <p class="text-xs text-gray-400 px-2">{subtitle}</p>}
  {backlink && <a href={backlink} target="_blank" class="text-xs text-gray-400 px-2">Credit: {backlinkText}</a>}
</div>